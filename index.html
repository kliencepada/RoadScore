<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RoadScore</title>

    <!--Leafet-->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<style>
    @media (max-width: 1100px) {
        #map {
            max-width: 100%;
            height: 300px;
        }
    }
</style>
</head>
<body>
    <header>
        <h1>RoadScore</h1>
        <p>Rate the quality of the road.</p>
        <hr>
    </header>
    <form id="report-form">
        <h3>1. Report Details</h3>
        
        <label>Rating:</label><br>
        <select id="category" required>
            <option value="">-- Select Rating --</option>
            <option value="0">0 - Unusable</option>
            <option value="1">⭐ - Very Poor</option>
            <option value="2">⭐⭐ - Poor</option>
            <option value="3">⭐⭐⭐ - Average</option>
            <option value="4">⭐⭐⭐⭐ - Good</option>
            <option value="5">⭐⭐⭐⭐⭐ - Excellent</option>
        </select>
        
        <label>Description:</label><br>
        <textarea id="description" rows="3" style="width: 100%;" placeholder="What is wrong with the road?"></textarea>
        <br><br>
        


<label>Attach Photo (Optional):</label><br>
<input type="file" id="imageInput" accept="image/*">
<br><br>


        <h3>2. Pin Location (Click the map)</h3>
        <p><i>Tip: Use the layers icon in the top-right of the map to filter by rating!</i></p>
        <div id="map" style="height: 500px; width: 100%; max-width: 1000px; margin: 0 auto;"></div>

        <button type="submit" id="submit-btn" disabled>Submit Report</button>
        <span id="status-msg" style="color: red; margin-left: 10px;"></span>
    </form>

    <h3>Recent Reports</h3>
    <div id="reports-list">
        <p>No reports yet.</p>
    </div>

    <main>
        
        <script>
            var map;
            var tempMarker = null;
            var selectedLat = null;
            var selectedLng = null;

        var streetLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19, attribution: '© OpenStreetMap'
        });
        var satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            maxZoom: 19, attribution: 'Tiles © Esri'
        });
        var layer0 = L.layerGroup();
        var layer1 = L.layerGroup();
        var layer2 = L.layerGroup();
        var layer3 = L.layerGroup();
        var layer4 = L.layerGroup();
        var layer5 = L.layerGroup();

        var baseMaps = {
            "Street View": streetLayer,
            "Satellite View": satelliteLayer
        };

        var overlayMaps = {
            "0 - Unusable": layer0,
            "⭐ - Very Poor": layer1,
            "⭐⭐ - Poor": layer2,
            "⭐⭐⭐ - Average": layer3,
            "⭐⭐⭐⭐ - Good": layer4,
            "⭐⭐⭐⭐⭐ - Excellent": layer5
        };

        map = L.map('map', {
            center: [8.36, 124.86], // Manolo Fortich
            zoom: 13,
            layers: [streetLayer, layer0, layer1, layer2, layer3, layer4, layer5]
        });

        L.control.layers(baseMaps, overlayMaps).addTo(map);

        map.on('click', function(e) {
            selectedLat = e.latlng.lat;
            selectedLng = e.latlng.lng;

            if (tempMarker) {
                map.removeLayer(tempMarker);
            }

            tempMarker = L.marker([selectedLat, selectedLng]).addTo(map);
            tempMarker.bindPopup("Selected Location").openPopup();

            document.getElementById('submit-btn').disabled = false;
            document.getElementById('status-msg').innerText = "Location ready!";
            document.getElementById('status-msg').style.color = "green";
        });
        
        document.getElementById('report-form').addEventListener('submit', function(e) {
            e.preventDefault();

            var category = document.getElementById('category').value;
            var desc = document.getElementById('description').value;
            

            if (!selectedLat || !selectedLng) {
                alert("Please pin a location on the map first.");
                document.getElementById('status-msg').innerText = "Please pin a location on the map first.";
                document.getElementById('status-msg').style.color = "red";
                return;
            }


            

            var targetLayer;
            if (category === "0") targetLayer = layer0;
            else if (category === "1") targetLayer = layer1;
            else if (category === "2") targetLayer = layer2;
            else if (category === "3") targetLayer = layer3;
            else if (category === "4") targetLayer = layer4;
            else targetLayer = layer5;

            var finalMarker = L.marker([selectedLat, selectedLng]);
            targetLayer.addLayer(finalMarker);
            
            finalMarker.bindPopup("<b>" + category + "</b><br>" + desc).openPopup();

            var list = document.getElementById('reports-list');
            if (list.innerHTML.includes("No reports yet")) {
                list.innerHTML = "";
            }

            var newReportDiv = document.createElement('div');
            newReportDiv.className = "report-item";
            newReportDiv.innerHTML = `
                <strong>${category}</strong> <span style="color:#666">(${new Date().toLocaleTimeString()})</span><br>
                ${desc} <br>
                <small>Lat: ${selectedLat.toFixed(4)}, Lng: ${selectedLng.toFixed(4)}</small>
            `;
            
            list.prepend(newReportDiv);
            var reportForm = document.getElementById('report-form');
            if (reportForm) {
            document.getElementById('status-msg').innerText = "";
            document.getElementById('status-msg').style.color = "red";
            }
            document.getElementById('submit-btn').disabled = true;
            document.getElementById('status-msg').innerText = "";
            
            if (tempMarker) {
                map.removeLayer(tempMarker);
                tempMarker = null;
            }
            selectedLat = null;
            selectedLng = null;

            alert("Report Submitted!");
        });
        
    </script>
</body>
</html>